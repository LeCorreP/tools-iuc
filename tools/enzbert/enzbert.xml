<tool id="enzbert" name="enzbert" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="21.05">
    <description>Transformer-based model that predicts the functional annotation of
    enzymes from protein sequences</description>
    <macros>
        <token name="@TOOL_VERSION@">1.1</token>
        <token name="@VERSION_SUFFIX@">0</token>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">enzbert</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        enzbert --fasta_path "$fasta_file" --top_k "$top_k" --path_model "$path_model" --chosen_model "$chosen_model" --max_seq_length "$max_seq_length" --output_attentions_scores &&
        cat attentions_scores.csv
    ]]></command>
    <inputs>
        <param argument="fasta_file" type="data" format="fasta,txt" label="File with the fasta sequence" />
        <param argument="path_model" type="text" label="Path to the data directory containing the model" />
        <param argument="max_seq_length" type="integer" value="2048" min="0" label="Limit the sequence length"/>
        <param argument="top_k" type="integer" value="3" min="0" label="How many predictions per sequence"/>
        <param name="chosen_model" type="select" label="Model to use" >
            <option value="EnzBert_SwissProt_2021_04" selected="true"></option>
            <option value="EnzBert_EC40"></option>
            <option value="EnzBert_ECPred40"></option>
        </param>      
    </inputs>
    <outputs>
        <data name="outpred" label="Enzbert predictions" format="csv" />
        <data name="outattention" label="Enzbert attention scores" format="csv" />
    </outputs>
    <tests>
        <test expect_num_outputs="2">
            <param name="fasta_file" value="example.fasta" />
            <param name="path_model" value="/home/plecorre/tfpc_complet/data/"/>
            <param name="max_seq_length" value="2048" />
            <param name="top_k" value="3" />
            <param name="chosen_model" value="EnzBert_SwissProt_2021_04"/>
            <output name="outpred" file="predictions.csv" ftype="csv" compare="sim_size"/>
            <output name="outattention" file="attentions_scores.csv" ftype="csv" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
        -h, --help            show this help message and exit
        --chosen_model CHOSEN_MODEL
                                Which models to use: EnzBert_SwissProt_2021_04,
                                EnzBert_EC40, EnzBert_ECPred40
        --fasta_path FASTA_PATH
                                Fasta file with the sequences
        --output_folder_path OUTPUT_FOLDER_PATH
                                Path of the csv output prediction
        --max_seq_length MAX_SEQ_LENGTH
                                Limit the sequence lenght and take only the begining
                                of the sequence. This can avoid Out Of Memory error
                                for very long sequences.
        --enzyme_a_priori     If we know the sequences are enzyme
        --output_attentions_scores
                                Compute and outputs attentions scores
        --top_k TOP_K         How many prediction per sequence
        --verbose             If the prediction results are shown in the terminal
        --path_model PATH_MODEL
                                Path of the directory containing the models
    ]]></help>
    <citations>
        <citation type="doi">https://doi.org/10.1093/bioinformatics/btad620</citation>
    </citations>
</tool>
